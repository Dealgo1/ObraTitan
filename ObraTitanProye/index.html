<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>ObraTitan</title>

    <!-- ============================= -->
    <!-- üé® √çcono y estilos -->
    <!-- ============================= -->
    <link rel="icon" type="image/svg+xml" href="/public/LogogrisObratitanOFICIAL.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- ============================= -->
    <!-- üìä Google Analytics -->
    <!-- ============================= -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-L45ZXJHHCL"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-L45ZXJHHCL");
    </script>

    <!-- ============================= -->
    <!-- üî• Hotjar -->
    <!-- ============================= -->
    <script>
      (function (h, o, t, j, a, r) {
        h.hj =
          h.hj ||
          function () {
            (h.hj.q = h.hj.q || []).push(arguments);
          };
        h._hjSettings = { hjid: 5363661, hjsv: 6 };
        a = o.getElementsByTagName("head")[0];
        r = o.createElement("script");
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
      })(
        window,
        document,
        "https://static.hotjar.com/c/hotjar-",
        ".js?sv="
      );
    </script>

    <!-- ============================= -->
    <!-- üì± Manifest PWA -->
    <!-- ============================= -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#D35400" />
  </head>

  <body>
    <div id="root"></div>

    <!-- ============================= -->
    <!-- ‚öõÔ∏è App principal de React -->
    <!-- ============================= -->
    <script type="module" src="./src/app/main.jsx"></script>

    <!-- ============================= -->
    <!-- ‚öôÔ∏è Registro del Service Worker -->
    <!-- ============================= -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then(async (reg) => {
              console.log("‚úÖ Service Worker registrado correctamente:", reg);

              // Forzar comprobaci√≥n de nueva versi√≥n en cada carga
              try {
                await reg.update();
              } catch (e) {
                console.warn("‚ö†Ô∏è No se pudo actualizar el SW:", e);
              }

              // Detectar si hay una nueva versi√≥n disponible
              reg.addEventListener("updatefound", () => {
                const newSW = reg.installing;
                newSW?.addEventListener("statechange", () => {
                  if (
                    newSW.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    console.log("‚ö° Nueva versi√≥n detectada. Recargando...");
                    window.location.reload();
                  }
                });
              });
            })
            .catch((err) =>
              console.error("‚ùå Error al registrar el Service Worker:", err)
            );
        });
      }
    </script>
  </body>
</html>
